<Page
    x:Class="FluentDL.Views.QueuePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Microsoft.UI.Xaml.Controls;assembly=Microsoft.WinUI"
    xmlns:controls1="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:CommunityToolkit.WinUI.UI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helpers="using:FluentDL.Helpers"
    xmlns:marqueeTextRns="using:CommunityToolkit.Labs.WinUI.MarqueeTextRns"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:FluentDL.Models"
    xmlns:system="using:System"
    xmlns:viewModels="using:FluentDL.ViewModels"
    xmlns:views="using:FluentDL.Views"
    x:Name="RootPage"
    NavigationCacheMode="Required"
    mc:Ignorable="d">
    <Page.Resources>
        <helpers:DateToYearConverter x:Key="DateToYearConverter" />
        <helpers:DurationConverter x:Key="DurationConverter" />
        <helpers:VisibilityConverter x:Key="VisibilityConverter" />
        <helpers:CollapsedConverter x:Key="CollapsedConverter" />
        <viewModels:QueueViewModel x:Key="QueueViewModel" />
        <views:PathToVisibilityConverter x:Key="PathToVisibilityConverter" />
        <helpers:NullVisibilityConverter x:Key="NullVisibilityConverter" />
        <helpers:InverseNullVisibilityConverter x:Key="InverseNullVisibilityConverter" />
        <helpers:SourceToColorConverter x:Key="SourceToColorConverter" />
        <helpers:LocalSourceToVisibilityConverter x:Key="LocalSourceToVisibilityConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <controls1:DockPanel Grid.Row="0" Grid.Column="0">
            <Button
                x:Name="CountTextButton"
                Margin="0,0,0,0"
                VerticalAlignment="Center"
                Background="Transparent"
                BorderBrush="Transparent">
                <TextBlock
                    x:Name="CountText"
                    Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                    Text="No tracks in queue" />
            </Button>
            <Button
                x:Name="ProgressTextButton"
                Margin="0,0,0,0"
                VerticalAlignment="Center"
                Background="Transparent"
                BorderBrush="Transparent"
                Visibility="Collapsed">
                <TextBlock x:Name="ProgressText" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" />
            </Button>

            <StackPanel
                HorizontalAlignment="Right"
                Orientation="Horizontal"
                Spacing="8">
                <Button
                    x:Name="ConvertDialogOpenButton"
                    VerticalAlignment="Center"
                    Click="ConvertDialogOpenButton_OnClick"
                    ToolTipService.ToolTip="Convert tracks to other sources">
                    <StackPanel Orientation="Horizontal">
                        <FontIcon
                            x:Name="ConvertDialogOpenIcon"
                            Margin="0,0,8,0"
                            FontSize="16"
                            Glyph="&#xEA3C;"
                            RenderTransformOrigin="0.5,0.5">
                            <FontIcon.RenderTransform>
                                <RotateTransform Angle="90" />
                            </FontIcon.RenderTransform>
                        </FontIcon>
                        <TextBlock Text="Convert" />
                    </StackPanel>
                </Button>

                <Button
                    x:Name="DownloadAllButton"
                    VerticalAlignment="Center"
                    Click="DownloadAllButton_Click"
                    ToolTipService.ToolTip="Download all tracks in queue">
                    <StackPanel Orientation="Horizontal">
                        <FontIcon
                            x:Name="DownloadAllButtonIcon"
                            Margin="0,0,8,0"
                            FontSize="16"
                            Glyph="&#xE896;" />
                        <TextBlock Text="Download" />
                    </StackPanel>
                </Button>

                <Button
                    x:Name="CommandButton"
                    VerticalAlignment="Center"
                    Click="CommandButton_OnClick"
                    ToolTipService.ToolTip="Run a command in Command Prompt">
                    <StackPanel Orientation="Horizontal">
                        <FontIcon
                            x:Name="CommandIcon"
                            Margin="0,0,8,0"
                            FontSize="16"
                            Glyph="&#xE756;" />
                        <TextBlock Text="CMD" />
                    </StackPanel>
                </Button>
                <Button
                    x:Name="ClearButton"
                    VerticalAlignment="Center"
                    Click="ClearButton_OnClick"
                    ToolTipService.ToolTip="Clear the queue">
                    <StackPanel Orientation="Horizontal">
                        <FontIcon
                            x:Name="ClearIcon"
                            Margin="0,0,8,0"
                            FontSize="16"
                            Glyph="&#xE894;" />
                        <TextBlock Text="Clear" />
                    </StackPanel>
                </Button>
                <Button
                    x:Name="StartStopButton"
                    VerticalAlignment="Center"
                    Click="StartStopButton_OnClick"
                    ToolTipService.ToolTip="Pause or continue running the command">
                    <StackPanel Orientation="Horizontal">
                        <FontIcon
                            x:Name="StartStopIcon"
                            Margin="0,0,8,0"
                            FontSize="16"
                            Glyph="&#xE768;" />
                        <TextBlock x:Name="StartStopText" Text="Continue" />
                    </StackPanel>
                </Button>
                <Button
                    x:Name="ConvertStopButton"
                    VerticalAlignment="Center"
                    Background="Transparent"
                    BorderBrush="Transparent"
                    Click="ConvertStopButton_OnClick"
                    ToolTipService.ToolTip="Stop conversion"
                    Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal">
                        <FontIcon
                            x:Name="ConvertStopIcon"
                            Margin="0,0,8,0"
                            FontSize="16"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            Glyph="&#xE71A;" />
                        <TextBlock
                            x:Name="ConvertStopText"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            Text="Stop" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </controls1:DockPanel>

        <ProgressBar
            x:Name="QueueProgress"
            Grid.Row="1"
            Grid.Column="0"
            Margin="0,8,0,12"
            IsIndeterminate="False"
            Value="0" />

        <ListView
            x:Name="CustomListView"
            Grid.Row="2"
            Grid.Column="0"
            Margin="0,0,0,12"
            Padding="0,0,12,0"
            BorderBrush="{ThemeResource ControlStrongStrokeColorDefaultBrush}"
            BorderThickness="0"
            CornerRadius="8"
            SelectionChanged="CustomListView_OnSelectionChanged">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="viewModels:QueueObject">
                    <Grid
                        Height="76"
                        Margin="0,12,0,12"
                        AutomationProperties.Name="{x:Bind Title}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="76" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <Border
                            Grid.Row="0"
                            Grid.RowSpan="3"
                            Grid.Column="0"
                            Height="76"
                            Margin="0"
                            Padding="0"
                            CornerRadius="4"
                            Visibility="{x:Bind LocalBitmapImage, Converter={StaticResource NullVisibilityConverter}}">
                            <Border.Background>
                                <ImageBrush ImageSource="{x:Bind LocalBitmapImage}" Stretch="UniformToFill" />
                            </Border.Background>
                        </Border>

                        <marqueeTextRns:MarqueeText
                            Grid.Row="0"
                            Grid.Column="1"
                            Margin="12,0,0,0"
                            VerticalAlignment="Center"
                            Behavior="Looping"
                            Direction="Left"
                            FontFamily="Segoe UI Variable Display"
                            FontWeight="Semibold"
                            RepeatBehavior="Forever"
                            Text="{x:Bind Title}" />

                        <marqueeTextRns:MarqueeText
                            Grid.Row="1"
                            Grid.Column="1"
                            Margin="12,0,0,0"
                            VerticalAlignment="Center"
                            Behavior="Looping"
                            Direction="Left"
                            FontFamily="Segoe UI Variable Display"
                            Foreground="{ThemeResource TextFillColorSecondary}"
                            RepeatBehavior="Forever"
                            Text="{x:Bind Artists}" />

                        <StackPanel
                            Grid.Row="2"
                            Grid.Column="1"
                            Margin="12,0,0,0"
                            VerticalAlignment="Bottom"
                            Orientation="Horizontal">
                            <TextBlock
                                Margin="0,0,0,0"
                                HorizontalAlignment="Left"
                                FontFamily="Segoe UI Variable Display"
                                Foreground="{ThemeResource TextFillColorSecondary}"
                                Style="{ThemeResource BodyTextBlockStyle}"
                                Text="{x:Bind ReleaseDate, Converter={StaticResource DateToYearConverter}}" />
                            <TextBlock
                                Margin="5,0,0,0"
                                HorizontalAlignment="Left"
                                FontFamily="Segoe UI Variable Display"
                                Foreground="{ThemeResource TextFillColorSecondary}"
                                Style="{ThemeResource BodyTextBlockStyle}"
                                Text="&#x2022;" />
                            <TextBlock
                                Margin="5,0,0,0"
                                HorizontalAlignment="Left"
                                FontFamily="Segoe UI Variable Display"
                                Foreground="{ThemeResource TextFillColorSecondary}"
                                Style="{ThemeResource BodyTextBlockStyle}"
                                Text="{x:Bind Duration, Converter={StaticResource DurationConverter}}" />
                        </StackPanel>

                        <StackPanel
                            Grid.Row="0"
                            Grid.Column="2"
                            Margin="12,0,0,0"
                            HorizontalAlignment="Right"
                            Orientation="Horizontal"
                            Spacing="12">

                            <Border
                                Margin="0,-2,0,0"
                                Padding="4,0"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Background="DarkGray"
                                CornerRadius="2"
                                Visibility="{x:Bind Explicit, Converter={StaticResource VisibilityConverter}}">
                                <TextBlock
                                    x:Name="ExplicitBadge"
                                    Foreground="Black"
                                    Style="{ThemeResource CaptionTextBlockStyle}"
                                    Text="E" />
                            </Border>
                            <Border
                                Padding="6,2"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Top"
                                Background="{ThemeResource LayerOnMicaBaseAltFillColorSecondaryBrush}"
                                CornerRadius="2">
                                <StackPanel Orientation="Horizontal">
                                    <Ellipse
                                        Width="10"
                                        Height="10"
                                        Margin="0,0,6,0"
                                        VerticalAlignment="Center"
                                        Fill="{x:Bind Source, Converter={StaticResource SourceToColorConverter}}"
                                        StrokeThickness="0" />
                                    <TextBlock
                                        x:Name="SourceBadge"
                                        Margin="0,-2,0,0"
                                        VerticalAlignment="Center"
                                        Style="{ThemeResource CaptionTextBlockStyle}"
                                        Text="{x:Bind Source}" />
                                </StackPanel>
                            </Border>

                        </StackPanel>
                        <!--  share, download cover, remove  -->
                        <StackPanel
                            Grid.Row="2"
                            Grid.Column="2"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Orientation="Horizontal"
                            Spacing="4">
                            <StackPanel
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Orientation="Horizontal"
                                Spacing="4"
                                Visibility="{x:Bind IsRunning, Converter={StaticResource CollapsedConverter}}">
                                <Button
                                    x:Name="ShareLinkButton"
                                    Padding="4,4,3,3"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Bottom"
                                    Click="ShareLinkButton_OnClick"
                                    Tag="{Binding}"
                                    ToolTipService.ToolTip="Copy track link"
                                    Visibility="{x:Bind ShareVisibility}">
                                    <FontIcon FontSize="20" Glyph="&#xE71B;" />
                                </Button>
                                <Button
                                    x:Name="DownloadCoverButton"
                                    Padding="4,4,3,3"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Bottom"
                                    Click="DownloadCoverButton_OnClick"
                                    Tag="{Binding}"
                                    ToolTipService.ToolTip="Download cover"
                                    Visibility="{x:Bind DownloadCoverVisibility}">
                                    <FontIcon FontSize="20" Glyph="&#xEE71;" />
                                </Button>
                                <Button
                                    x:Name="RemoveButton"
                                    Padding="4,4,3,3"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Bottom"
                                    Click="RemoveButton_OnClick"
                                    Tag="{Binding}"
                                    ToolTipService.ToolTip="Remove from queue"
                                    Visibility="{x:Bind RemoveVisibility}">
                                    <FontIcon FontSize="20" Glyph="&#xECC9;" />
                                </Button>

                                <StackPanel
                                    Padding="0"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Bottom"
                                    Orientation="Horizontal"
                                    Spacing="4"
                                    Visibility="{x:Bind Source, Converter={StaticResource LocalSourceToVisibilityConverter}, Mode=OneWay}">
                                    <Button
                                        x:Name="OpenSpekButton"
                                        Padding="4,4,3,3"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Bottom"
                                        Click="OpenSpekButton_Click"
                                        Tag="{Binding}"
                                        ToolTipService.ToolTip="Open with Spek">
                                        <FontIcon FontSize="20" Glyph="&#xE9D2;" />
                                    </Button>
                                    <Button
                                        x:Name="OpenLocalButton"
                                        Padding="4,4,3,3"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Bottom"
                                        Click="OpenLocalButton_Click"
                                        Tag="{Binding}"
                                        ToolTipService.ToolTip="Open in File Explorer">
                                        <FontIcon FontSize="20" Glyph="&#xE8DA;" />
                                    </Button>
                                </StackPanel>
                            </StackPanel>

                            <Button
                                x:Name="OutputButton"
                                Padding="4,4,3,3"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Click="OutputButton_OnClick"
                                Style="{ThemeResource AccentButtonStyle}"
                                Tag="{Binding}"
                                ToolTipService.ToolTip="View command output"
                                Visibility="{x:Bind ResultString, Converter={StaticResource PathToVisibilityConverter}}">
                                <FontIcon FontSize="20" Glyph="&#xE756;" />
                            </Button>
                            <ProgressRing
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Visibility="{x:Bind IsRunning, Converter={StaticResource VisibilityConverter}}" />
                        </StackPanel>


                        <InfoBadge
                            x:Name="ConvertInfoBadge"
                            Grid.Row="0"
                            Grid.Column="0"
                            Width="12"
                            Height="12"
                            Margin="-6,-6,0,0"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top"
                            Background="{x:Bind ConvertBadgeColor}" />

                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <TextBlock
            x:Name="NoItemsText"
            Grid.Row="2"
            Grid.Column="0"
            Margin="0,-8,0,0"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Text="Add tracks through Search or Local Explorer."
            Visibility="Visible" />

        <views:PreviewPane
            x:Name="PreviewPanel"
            Grid.Row="0"
            Grid.RowSpan="3"
            Grid.Column="1"
            Margin="12,-2,0,12"
            Padding="12"
            VerticalAlignment="Stretch" />

        <!--  Content Dialog for command running  -->
        <ContentDialog
            x:Name="CustomCommandDialog"
            Title="Run Command"
            CloseButtonText="Cancel"
            IsPrimaryButtonEnabled="True"
            IsSecondaryButtonEnabled="True"
            PrimaryButtonClick="CustomCommandDialog_OnPrimaryButtonClick"
            PrimaryButtonStyle="{ThemeResource AccentButtonStyle}"
            PrimaryButtonText="Run">
            <StackPanel Spacing="12">

                <InfoBar
                    Margin="0,0,0,0"
                    IsClosable="False"
                    IsOpen="True"
                    Message="Run custom commands (with Command Prompt) on each queue item. Click on the wildcards below for more details."
                    Severity="Informational" />

                <ScrollViewer
                    x:Name="ScrollViewerWildcards"
                    HorizontalAlignment="Stretch"
                    HorizontalScrollBarVisibility="Visible"
                    HorizontalScrollMode="Enabled"
                    ToolTipService.ToolTip="Available wildcards"
                    VerticalScrollMode="Disabled">
                    <StackPanel
                        Margin="0,0,0,16"
                        Orientation="Horizontal"
                        Spacing="8">
                        <Button
                            Content="{}{url}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            ToolTipService.ToolTip="The source URL of the track">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock
                                        MaxWidth="400"
                                        Text="The source URL if online source (e.g., https://api.deezer.com/track/123456) or the absolute path if local file (e.g., C:/folder/file.extension)"
                                        TextWrapping="WrapWholeWords" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button
                            Content="{}{ext}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            ToolTipService.ToolTip="The file extension of the track">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock
                                        MaxWidth="400"
                                        Text="The file extension of the track WITHOUT the period (e.g., mp3, wav)"
                                        TextWrapping="WrapWholeWords" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button
                            Content="{}{file_name}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            ToolTipService.ToolTip="The file name of the track">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock
                                        MaxWidth="400"
                                        Text="The file name of the track without its extension"
                                        TextWrapping="WrapWholeWords" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button
                            Content="{}{title}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            ToolTipService.ToolTip="The title of the track">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock
                                        MaxWidth="400"
                                        Text="The title of the track"
                                        TextWrapping="WrapWholeWords" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button
                            Content="{}{image_url}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            ToolTipService.ToolTip="The image URL of the track">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock
                                        MaxWidth="400"
                                        Text="The image URL of the track (only applicable to online sources)"
                                        TextWrapping="WrapWholeWords" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button
                            Content="{}{id}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            ToolTipService.ToolTip="The ID of the track">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock
                                        MaxWidth="400"
                                        Text="The ID of the track, often a number (only applicable to online sources)"
                                        TextWrapping="WrapWholeWords" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button
                            Content="{}{release_date}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            ToolTipService.ToolTip="The release date of the track">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock
                                        MaxWidth="400"
                                        Text="The release date of the track, format YYYY-MM-DD"
                                        TextWrapping="WrapWholeWords" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button
                            Content="{}{artists}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            ToolTipService.ToolTip="The artists of the track">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock
                                        MaxWidth="400"
                                        Text="The artists of the track, comma separated (eg. artist1, artist2, artist3)"
                                        TextWrapping="WrapWholeWords" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button
                            Content="{}{duration}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            ToolTipService.ToolTip="The duration of the track">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock
                                        MaxWidth="400"
                                        Text="The duration of the track in seconds (eg. 237)"
                                        TextWrapping="WrapWholeWords" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button
                            Content="{}{album}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            ToolTipService.ToolTip="The album name of the track">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock
                                        MaxWidth="400"
                                        Text="The album name of the track"
                                        TextWrapping="WrapWholeWords" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                        <Button
                            Content="{}{isrc}"
                            Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                            ToolTipService.ToolTip="The ISRC (International Standard Recording Code) identifier for the track">
                            <Button.Flyout>
                                <Flyout>
                                    <TextBlock
                                        MaxWidth="400"
                                        Text="The ISRC (International Standard Recording Code) identifier for the track (eg. CCXXXYYNNNNN)"
                                        TextWrapping="WrapWholeWords" />
                                </Flyout>
                            </Button.Flyout>
                        </Button>
                    </StackPanel>
                </ScrollViewer>

                <AutoSuggestBox
                    x:Name="DirectoryInput"
                    Margin="0,0,0,8"
                    HorizontalAlignment="Stretch"
                    PlaceholderText="Directory of command prompt"
                    SuggestionChosen="DirectoryInput_OnSuggestionChosen"
                    TextChanged="DirectoryInput_OnTextChanged"
                    ToolTipService.ToolTip="The directory to run commands in">
                    <AutoSuggestBox.Header>
                        <TextBlock
                            Foreground="{ThemeResource TextFillColorSecondary}"
                            Style="{ThemeResource CaptionTextBlockStyle}"
                            Text="Directory" />
                    </AutoSuggestBox.Header>
                </AutoSuggestBox>

                <AutoSuggestBox
                    x:Name="CommandInput"
                    Margin="0,0,0,8"
                    HorizontalAlignment="Stretch"
                    PlaceholderText="Run custom command"
                    SuggestionChosen="CommandInput_OnSuggestionChosen"
                    TextChanged="CommandInput_OnTextChanged"
                    ToolTipService.ToolTip="The command to be run in Command Prompt">
                    <AutoSuggestBox.Header>
                        <TextBlock
                            Foreground="{ThemeResource TextFillColorSecondary}"
                            Style="{ThemeResource CaptionTextBlockStyle}"
                            Text="Command" />
                    </AutoSuggestBox.Header>
                </AutoSuggestBox>
            </StackPanel>
        </ContentDialog>


        <InfoBar
            x:Name="PageInfoBar"
            Grid.Row="0"
            Grid.RowSpan="3"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Margin="12"
            HorizontalAlignment="Center"
            VerticalAlignment="Bottom"
            HorizontalContentAlignment="Stretch"
            Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}"
            Canvas.ZIndex="1"
            CloseButtonClick="PageInfoBar_OnCloseButtonClick"
            IsOpen="False"
            Opacity="0">
            <InfoBar.OpacityTransition>
                <ScalarTransition Duration="0:0:0.25" />
            </InfoBar.OpacityTransition>
            <InfoBar.Content>
                <Grid
                    x:Name="InfobarContent"
                    Margin="0,0,0,0"
                    Padding="0,0,0,0"
                    VerticalAlignment="Center">
                    <TextBlock
                        x:Name="InfoBarTextBlock"
                        Margin="0,0,0,0"
                        VerticalAlignment="Center" />
                    <ProgressBar
                        x:Name="InfobarProgress"
                        Margin="0,0,0,-8"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Bottom"
                        IsIndeterminate="True"
                        Visibility="Collapsed" />
                </Grid>
            </InfoBar.Content>
        </InfoBar>

        <!--  Content Dialog for cli output  -->
        <ContentDialog
            x:Name="OutputDialog"
            Title="Output"
            CloseButtonText="Close"
            IsPrimaryButtonEnabled="True"
            IsSecondaryButtonEnabled="True"
            PrimaryButtonClick="OutputDialog_OnPrimaryButtonClick"
            PrimaryButtonStyle="{ThemeResource AccentButtonStyle}"
            PrimaryButtonText="Copy">
            <StackPanel Spacing="12">
                <TextBlock x:Name="OutputMessage" Margin="0,0,0,0" />
                <RichEditBox
                    x:Name="OutputTextBox"
                    Height="Auto"
                    HorizontalAlignment="Stretch" />
            </StackPanel>
        </ContentDialog>

        <!--  Content Dialog for conversion  -->
        <ContentDialog
            x:Name="ConversionDialog"
            Title="Convert Sources"
            CloseButtonText="Close"
            IsPrimaryButtonEnabled="True"
            PrimaryButtonClick="ConversionDialog_OnPrimaryButtonClick"
            PrimaryButtonStyle="{ThemeResource AccentButtonStyle}"
            PrimaryButtonText="Convert">
            <StackPanel>
                <InfoBar
                    Margin="0,0,0,12"
                    IsClosable="False"
                    IsOpen="True"
                    Message="Select at least one input and output."
                    Severity="Informational" />

                <Grid VerticalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock
                            Margin="0,0,0,2"
                            Foreground="{ThemeResource TextFillColorSecondary}"
                            Style="{ThemeResource CaptionTextBlockStyle}"
                            Text="Input" />
                        <CheckBox
                            x:Name="DeezerCheckBox"
                            Checked="CheckBox_OnChecked"
                            Content="Deezer"
                            Unchecked="CheckBox_OnUnchecked" />
                        <CheckBox
                            x:Name="QobuzCheckBox"
                            Checked="CheckBox_OnChecked"
                            Content="Qobuz"
                            Unchecked="CheckBox_OnUnchecked" />
                        <CheckBox
                            x:Name="SpotifyCheckBox"
                            Checked="CheckBox_OnChecked"
                            Content="Spotify"
                            Unchecked="CheckBox_OnUnchecked" />
                        <CheckBox
                            x:Name="YouTubeCheckBox"
                            Checked="CheckBox_OnChecked"
                            Content="YouTube"
                            Unchecked="CheckBox_OnUnchecked" />
                        <CheckBox
                            x:Name="LocalCheckBox"
                            Checked="CheckBox_OnChecked"
                            Content="Local"
                            Unchecked="CheckBox_OnUnchecked" />
                    </StackPanel>

                    <StackPanel Grid.Column="1">
                        <TextBlock
                            Margin="0,0,0,4"
                            Foreground="{ThemeResource TextFillColorSecondary}"
                            Style="{ThemeResource CaptionTextBlockStyle}"
                            Text="Output" />
                        <ComboBox
                            x:Name="OutputComboBox"
                            Margin="0,0,0,0"
                            HorizontalAlignment="Stretch"
                            PlaceholderText="Select output"
                            ToolTipService.ToolTip="The source to convert to" />
                    </StackPanel>
                </Grid>
            </StackPanel>
        </ContentDialog>

        <!--  Content Dialog for conversion results  -->
        <ContentDialog
            x:Name="ConversionResultsDialog"
            Title="Conversion Summary"
            CloseButtonText="Close">
            <StackPanel>
                <TabView
                    x:Name="ConversionTabView"
                    Margin="0,0,4,0"
                    IsAddTabButtonVisible="False"
                    SelectionChanged="ConversionTabView_OnSelectionChanged">
                    <TabView.Resources>
                        <ResourceDictionary>
                            <ResourceDictionary.ThemeDictionaries>
                                <ResourceDictionary x:Key="Light">
                                    <SolidColorBrush x:Key="TabViewItemHeaderBackgroundSelected" Color="{ThemeResource CardBackgroundFillColorSecondary}" />
                                </ResourceDictionary>
                                <ResourceDictionary x:Key="Dark">
                                    <SolidColorBrush x:Key="TabViewItemHeaderBackgroundSelected" Color="{ThemeResource CardBackgroundFillColorSecondary}" />
                                </ResourceDictionary>
                            </ResourceDictionary.ThemeDictionaries>
                        </ResourceDictionary>
                    </TabView.Resources>

                    <TabView.TabItems>
                        <TabViewItem
                            x:Name="SuccessTab"
                            HorizontalContentAlignment="Stretch"
                            Header="Success"
                            IsClosable="False">
                            <TabViewItem.HeaderTemplate>
                                <DataTemplate>
                                    <Grid HorizontalAlignment="Stretch">
                                        <TextBlock Text="{Binding ElementName=SuccessTab, Path=Header}" />
                                        <InfoBadge
                                            Margin="2,0"
                                            HorizontalAlignment="Right"
                                            Background="{ThemeResource SystemFillColorSuccessBrush}"
                                            Value="{Binding ElementName=RootPage, Path=ViewModel.SuccessCount, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </TabViewItem.HeaderTemplate>
                        </TabViewItem>

                        <TabViewItem
                            x:Name="WarningTab"
                            HorizontalContentAlignment="Stretch"
                            Header="Warning"
                            IsClosable="False">
                            <TabViewItem.HeaderTemplate>
                                <DataTemplate>
                                    <Grid HorizontalAlignment="Stretch">
                                        <TextBlock Text="{Binding ElementName=WarningTab, Path=Header}" />
                                        <InfoBadge
                                            Margin="2,0"
                                            HorizontalAlignment="Right"
                                            Background="{ThemeResource SystemFillColorCautionBrush}"
                                            Value="{Binding ElementName=RootPage, Path=ViewModel.WarningCount, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </TabViewItem.HeaderTemplate>
                        </TabViewItem>

                        <TabViewItem
                            x:Name="ErrorTab"
                            HorizontalContentAlignment="Stretch"
                            Header="Error"
                            IsClosable="False">
                            <TabViewItem.HeaderTemplate>
                                <DataTemplate>
                                    <Grid HorizontalAlignment="Stretch">
                                        <TextBlock Text="{Binding ElementName=ErrorTab, Path=Header}" />
                                        <InfoBadge
                                            Margin="2,0"
                                            HorizontalAlignment="Right"
                                            Background="{ThemeResource SystemFillColorCriticalBrush}"
                                            Value="{Binding ElementName=RootPage, Path=ViewModel.ErrorCount, Mode=OneWay}" />
                                    </Grid>
                                </DataTemplate>
                            </TabViewItem.HeaderTemplate>
                        </TabViewItem>
                    </TabView.TabItems>
                </TabView>

                <Border
                    x:Name="TabCard"
                    Padding="4,8,4,8"
                    Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                    BorderBrush="{ThemeResource ControlStrongStrokeColorDefaultBrush}"
                    CornerRadius="4">
                    <StackPanel>
                        <InfoBar
                            x:Name="TabInfoBar"
                            Margin="4,0,4,8"
                            IsClosable="False"
                            IsOpen="True" />
                        <Grid>
                            <ListView
                                x:Name="ConversionListView"
                                Height="400"
                                Margin="0,0,0,0"
                                Padding="2,0,12,0"
                                VerticalAlignment="Center"
                                Background="Transparent"
                                BorderBrush="Transparent"
                                BorderThickness="0"
                                CornerRadius="4">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="models:SongSearchObject">
                                        <Grid Margin="0,12,0,12" AutomationProperties.Name="{x:Bind Title}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="76" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Border Height="76" CornerRadius="4">
                                                <Border.Background>
                                                    <ImageBrush ImageSource="{x:Bind ImageLocation}" Stretch="UniformToFill" />
                                                </Border.Background>
                                            </Border>

                                            <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock
                                                        Margin="0,0,8,0"
                                                        HorizontalAlignment="Left"
                                                        FontFamily="Segoe UI Variable Display"
                                                        MaxLines="1"
                                                        Style="{ThemeResource BodyStrongTextBlockStyle}"
                                                        Text="{x:Bind Title}"
                                                        TextTrimming="CharacterEllipsis" />
                                                    <Border
                                                        Padding="4,0"
                                                        VerticalAlignment="Center"
                                                        Background="DarkGray"
                                                        CornerRadius="2">
                                                        <TextBlock
                                                            x:Name="ExplicitBadgeFailed"
                                                            Foreground="Black"
                                                            Style="{ThemeResource CaptionTextBlockStyle}"
                                                            Text="E"
                                                            Visibility="{x:Bind Explicit, Converter={StaticResource VisibilityConverter}}" />
                                                    </Border>
                                                </StackPanel>
                                                <TextBlock
                                                    FontFamily="Segoe UI Variable Display"
                                                    MaxLines="1"
                                                    Style="{ThemeResource BodyTextBlockStyle}"
                                                    Text="{x:Bind Artists}"
                                                    TextTrimming="CharacterEllipsis" />
                                            </StackPanel>

                                            <StackPanel
                                                Grid.Column="1"
                                                Margin="12,0,0,0"
                                                VerticalAlignment="Bottom"
                                                Orientation="Horizontal">
                                                <TextBlock
                                                    Margin="0,0,0,0"
                                                    HorizontalAlignment="Left"
                                                    FontFamily="Segoe UI Variable Display"
                                                    Style="{ThemeResource BodyTextBlockStyle}"
                                                    Text="{x:Bind ReleaseDate, Converter={StaticResource DateToYearConverter}}" />
                                                <TextBlock
                                                    Margin="5,0,0,0"
                                                    HorizontalAlignment="Left"
                                                    Style="{ThemeResource BodyTextBlockStyle}"
                                                    Text="&#x2022;" />
                                                <TextBlock
                                                    Margin="5,0,0,0"
                                                    HorizontalAlignment="Left"
                                                    FontFamily="Segoe UI Variable Display"
                                                    Style="{ThemeResource BodyTextBlockStyle}"
                                                    Text="{x:Bind Duration, Converter={StaticResource DurationConverter}}" />
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                            <TextBlock
                                x:Name="NoConversionText"
                                Margin="0,-8,0,0"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Visibility="Collapsed">
                                No tracks.
                            </TextBlock>
                        </Grid>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ContentDialog>
    </Grid>
</Page>